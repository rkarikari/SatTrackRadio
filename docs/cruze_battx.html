<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cruze Battery Tracker - Enhanced</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.8/umd/Recharts.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; }
        #root { width: 100%; min-height: 100vh; }
        
        /* Enhanced styling inspired by satellite analysis */
        .metric-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.6);
        }
        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-excellent { background: rgba(16, 185, 129, 0.2); color: #10b981; border: 1px solid #10b981; }
        .status-good { background: rgba(59, 130, 246, 0.2); color: #3b82f6; border: 1px solid #3b82f6; }
        .status-warning { background: rgba(251, 191, 36, 0.2); color: #fbbf24; border: 1px solid #fbbf24; }
        .status-critical { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid #ef4444; }
        
        /* Tab styling */
        .tab-button {
            transition: all 0.3s ease;
            border-radius: 10px 10px 0 0;
        }
        .tab-button.active {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        /* Loading screen */
        #loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #1f2937;
            color: white;
            font-family: Arial, sans-serif;
        }
        
        /* Enhanced glow effects */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.6); }
        }
        .glow-box {
            animation: pulse-glow 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <!-- Loading screen that shows until React app loads -->
    <div id="loading">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
            <p>Loading Enhanced Cruze Battery Tracker...</p>
        </div>
    </div>
    
    <div id="root"></div>
    
    <script type="text/babel">
        // Show loading screen initially
        document.getElementById('loading').style.display = 'flex';
        
        // Create a comprehensive icon component system
        const Icon = ({ name, className = "" }) => {
            const icons = {
                battery: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                    </svg>
                ),
                sun: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                ),
                key: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
                    </svg>
                ),
                trendingDown: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
                    </svg>
                ),
                calendar: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                ),
                settings: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                ),
                barChart3: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                ),
                info: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                ),
                plus: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                    </svg>
                ),
                trash2: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                ),
                download: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                ),
                upload: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                    </svg>
                ),
                car: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                    </svg>
                ),
                activity: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                )
            };
            
            return icons[name] || <span>?</span>;
        };

        const { useState, useEffect } = React;
        
        // Check if Recharts is available
        let Recharts;
        try {
            Recharts = window.Recharts;
        } catch (e) {
            console.error("Recharts not loaded:", e);
            Recharts = {};
        }

        // Create fallback components if Recharts fails to load
        const createFallbackChart = (title, data) => (
            <div className="p-4 border rounded bg-yellow-50 border-yellow-200">
                <h3 className="font-bold text-yellow-800 mb-2">{title}</h3>
                <p className="text-yellow-700">Chart library not available. Displaying data as table:</p>
                <div className="mt-2 max-h-60 overflow-auto">
                    <table className="min-w-full">
                        <thead>
                            <tr className="bg-yellow-100">
                                {Object.keys(data[0] || {}).map(key => (
                                    <th key={key} className="px-4 py-2 text-left text-xs font-medium text-yellow-800 uppercase tracking-wider">{key}</th>
                                ))}
                            </tr>
                        </thead>
                        <tbody>
                            {data.map((row, i) => (
                                <tr key={i} className={i % 2 === 0 ? 'bg-white' : 'bg-yellow-50'}>
                                    {Object.values(row).map((value, j) => (
                                        <td key={j} className="px-4 py-2 whitespace-nowrap text-sm text-yellow-900">{value}</td>
                                    ))}
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        const BatteryTrackerApp = () => {
          const [activeTab, setActiveTab] = useState('dashboard');
          const [batteryLevel, setBatteryLevel] = useState(78);
          const [lastCharge, setLastCharge] = useState(new Date().toISOString().split('T')[0]);
          const [solarPanelActive, setSolarPanelActive] = useState(true);
          const [sunHoursPerDay, setSunHoursPerDay] = useState(4);
          const [remoteStarts, setRemoteStarts] = useState([]);
          const [remoteStartCount, setRemoteStartCount] = useState(0);
          const [fuelLevel, setFuelLevel] = useState(3.5);
          const [logs, setLogs] = useState([]);
          const [darkMode, setDarkMode] = useState(true);
          const [chartsLoaded, setChartsLoaded] = useState(false);

          // Technical constants based on research
          const CONSTANTS = {
            parasiticDraw: 0.03, // Amps
            parasiticDrawDaily: 0.72, // Ah per day
            batteryCapacity: 48, // Ah total
            usableCapacity: 24, // Ah (50% DOD safe limit)
            remoteStartDuration: 10, // minutes
            remoteStartCharge: 3.0, // Ah per 10-min start
            remoteStartLimit: 2, // consecutive starts allowed
            crankingAh: 0.17, // Ah per start
            solarPanelWatts: 5,
            solarPeakCurrent: 0.30, // Amps
            solarUsablePerHour: 0.225, // Ah per sun hour (average)
            fuelBurnRate: 0.0167, // gallons per 10-min idle
          };

          // Check if charts are available
          useEffect(() => {
            if (window.Recharts && Object.keys(window.Recharts).length > 0) {
              setChartsLoaded(true);
              // Hide loading screen once everything is ready
              document.getElementById('loading').style.display = 'none';
            } else {
              // If charts aren't available after a delay, hide loading screen anyway
              setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                setChartsLoaded(false);
              }, 2000);
            }
          }, []);

          // Calculate days until battery critical
          const calculateDaysRemaining = () => {
            const currentAh = (batteryLevel / 100) * CONSTANTS.usableCapacity;
            const dailyDrain = CONSTANTS.parasiticDrawDaily;
            const solarGain = solarPanelActive ? sunHoursPerDay * CONSTANTS.solarUsablePerHour : 0;
            const netDaily = solarGain - dailyDrain;
            
            if (netDaily >= 0) return Infinity;
            return Math.floor(currentAh / Math.abs(netDaily));
          };

          // Calculate battery level over time
          const generateProjection = (days = 365) => {
            const data = [];
            let currentLevel = batteryLevel;
            
            for (let day = 0; day <= days; day++) {
              const dailyDrain = CONSTANTS.parasiticDrawDaily;
              const solarGain = solarPanelActive ? sunHoursPerDay * CONSTANTS.solarUsablePerHour : 0;
              const netDaily = solarGain - dailyDrain;
              
              currentLevel = Math.max(0, Math.min(100, currentLevel + (netDaily / CONSTANTS.usableCapacity) * 100));
              
              if (day % 7 === 0) {
                data.push({
                  day,
                  battery: parseFloat(currentLevel.toFixed(1)),
                  sustainable: solarGain >= dailyDrain ? 100 : null
                });
              }
              
              if (currentLevel <= 0) break;
            }
            
            return data;
          };

          // Add remote start
          const addRemoteStart = () => {
            if (remoteStartCount >= CONSTANTS.remoteStartLimit) {
              alert('Maximum 2 remote starts reached! Physical start required to reset.');
              return;
            }
            
            const newStart = {
              id: Date.now(),
              date: new Date().toISOString(),
              ahGained: CONSTANTS.remoteStartCharge,
              fuelUsed: CONSTANTS.fuelBurnRate
            };
            
            setRemoteStarts([newStart, ...remoteStarts]);
            setRemoteStartCount(prev => prev + 1);
            setBatteryLevel(prev => Math.min(100, prev + (CONSTANTS.remoteStartCharge / CONSTANTS.usableCapacity) * 100));
            setFuelLevel(prev => Math.max(0, prev - CONSTANTS.fuelBurnRate));
            
            addLog(`Remote start activated (+${CONSTANTS.remoteStartCharge} Ah, -${CONSTANTS.fuelBurnRate} gal)`);
          };

          // Physical start (resets remote start counter)
          const physicalStart = () => {
            setRemoteStartCount(0);
            setBatteryLevel(prev => Math.min(100, prev + 5));
            addLog('Physical start - remote start counter reset');
          };

          // Add log entry
          const addLog = (message) => {
            setLogs(prev => [{
              id: Date.now(),
              date: new Date().toISOString(),
              message
            }, ...prev.slice(0, 49)]);
          };

          // Generate scenario comparison data
          const generateScenarioData = () => {
            return [
              { scenario: 'No Solar/No RS', days: 33, color: '#ef4444' },
              { scenario: '1 RS/month', days: 38, color: '#f59e0b' },
              { scenario: '2 RS/month', days: 46, color: '#eab308' },
              { scenario: 'Solar (2h) + 2 RS', days: 1200, color: '#22c55e' },
              { scenario: 'Solar (5h)', days: Infinity, color: '#10b981' }
            ].map(item => ({
              ...item,
              daysDisplay: item.days === Infinity ? 365 : item.days
            }));
          };

          // Solar vs parasitic comparison
          const generateSolarComparison = () => {
            return [0, 1, 2, 3, 4, 5, 6].map(hours => ({
              hours,
              solarGain: hours * CONSTANTS.solarUsablePerHour,
              parasiticLoss: CONSTANTS.parasiticDrawDaily,
              netDaily: (hours * CONSTANTS.solarUsablePerHour) - CONSTANTS.parasiticDrawDaily
            }));
          };

          const daysRemaining = calculateDaysRemaining();
          const projectionData = generateProjection(Math.min(daysRemaining === Infinity ? 365 : daysRemaining * 2, 365));
          const scenarioData = generateScenarioData();
          const solarComparisonData = generateSolarComparison();

          // Dashboard Tab
          const DashboardTab = () => (
            <div className="space-y-6">
              {/* Status Cards */}
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div className="metric-card p-4 glow-box">
                  <div className="flex items-center justify-between mb-2">
                    <Icon name="battery" className="w-6 h-6 text-blue-400" />
                    <span className="text-2xl font-bold text-blue-400">{batteryLevel.toFixed(1)}%</span>
                  </div>
                  <div className="text-sm opacity-90">Battery Level</div>
                  <div className="text-xs mt-1 opacity-75">{(batteryLevel * CONSTANTS.usableCapacity / 100).toFixed(1)} Ah available</div>
                </div>

                <div className={`metric-card p-4 ${daysRemaining === Infinity ? 'glow-box' : ''}`}>
                  <div className="flex items-center justify-between mb-2">
                    <Icon name="calendar" className="w-6 h-6 text-green-400" />
                    <span className="text-2xl font-bold text-green-400">{daysRemaining === Infinity ? '∞' : daysRemaining}</span>
                  </div>
                  <div className="text-sm opacity-90">Days Remaining</div>
                  <div className="text-xs mt-1 opacity-75">{daysRemaining === Infinity ? 'Self-sustaining' : 'Until charge needed'}</div>
                </div>

                <div className="metric-card p-4">
                  <div className="flex items-center justify-between mb-2">
                    <Icon name="sun" className="w-6 h-6 text-yellow-400" />
                    <span className="text-2xl font-bold text-yellow-400">{sunHoursPerDay}h</span>
                  </div>
                  <div className="text-sm opacity-90">Sun Hours/Day</div>
                  <div className="text-xs mt-1 opacity-75">+{(sunHoursPerDay * CONSTANTS.solarUsablePerHour).toFixed(2)} Ah/day</div>
                </div>

                <div className="metric-card p-4">
                  <div className="flex items-center justify-between mb-2">
                    <Icon name="key" className="w-6 h-6 text-purple-400" />
                    <span className="text-2xl font-bold text-purple-400">{remoteStartCount}/2</span>
                  </div>
                  <div className="text-sm opacity-90">Remote Starts</div>
                  <div className="text-xs mt-1 opacity-75">Fuel: {fuelLevel.toFixed(2)} gal</div>
                </div>
              </div>

              {/* Quick Actions */}
              <div className="metric-card p-4">
                <h3 className="font-semibold mb-3 flex items-center text-white">
                  <Icon name="key" className="w-5 h-5 mr-2" />
                  Quick Actions
                </h3>
                <div className="grid grid-cols-2 gap-3">
                  <button 
                    onClick={addRemoteStart}
                    disabled={remoteStartCount >= CONSTANTS.remoteStartLimit}
                    className={`${remoteStartCount >= CONSTANTS.remoteStartLimit ? 'bg-gray-600 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'} text-white py-3 px-4 rounded-lg font-medium transition`}
                  >
                    Remote Start
                  </button>
                  <button 
                    onClick={physicalStart}
                    className="bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition"
                  >
                    Physical Start
                  </button>
                </div>
                {remoteStartCount >= CONSTANTS.remoteStartLimit && (
                  <div className="mt-3 text-sm p-2 rounded text-red-400 bg-red-900/30">
                    ⚠️ Remote start limit reached. Physical start required to reset counter.
                  </div>
                )}
              </div>

              {/* Battery Projection Chart */}
              <div className="metric-card p-4">
                <h3 className="font-semibold mb-3 text-white">Battery Level Projection</h3>
                {chartsLoaded ? (
                  <Recharts.ResponsiveContainer width="100%" height={250}>
                    <Recharts.AreaChart data={projectionData}>
                      <Recharts.CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                      <Recharts.XAxis 
                        dataKey="day" 
                        label={{ value: 'Days', position: 'insideBottom', offset: -5, fill: '#9ca3af' }} 
                        stroke="#9ca3af"
                      />
                      <Recharts.YAxis 
                        label={{ value: 'Battery %', angle: -90, position: 'insideLeft', fill: '#9ca3af' }} 
                        stroke="#9ca3af"
                      />
                      <Recharts.Tooltip 
                        contentStyle={{
                          backgroundColor: '#1f2937',
                          border: '1px solid #374151',
                          color: '#f3f4f6'
                        }}
                      />
                      <Recharts.Area type="monotone" dataKey="battery" stroke="#3b82f6" fill="#93c5fd" name="Battery Level %" />
                      {projectionData[0]?.sustainable && (
                        <Recharts.Line type="monotone" dataKey="sustainable" stroke="#22c55e" strokeDasharray="5 5" name="Sustainable" />
                      )}
                    </Recharts.AreaChart>
                  </Recharts.ResponsiveContainer>
                ) : (
                  createFallbackChart("Battery Level Projection", projectionData)
                )}
              </div>

              {/* Net Energy Balance */}
              <div className="metric-card p-4">
                <h3 className="font-semibold mb-3 text-white">Daily Energy Balance</h3>
                <div className="space-y-2">
                  <div className="flex justify-between items-center">
                    <span className="text-sm text-gray-400">Parasitic Drain:</span>
                    <span className="font-semibold text-red-600">-{CONSTANTS.parasiticDrawDaily} Ah/day</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-sm text-gray-400">Solar Gain:</span>
                    <span className="font-semibold text-green-600">+{(sunHoursPerDay * CONSTANTS.solarUsablePerHour).toFixed(2)} Ah/day</span>
                  </div>
                  <div className="border-t pt-2 flex justify-between items-center border-gray-700">
                    <span className="text-sm font-semibold text-gray-300">Net Daily:</span>
                    <span className={`font-bold ${(sunHoursPerDay * CONSTANTS.solarUsablePerHour - CONSTANTS.parasiticDrawDaily) >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                      {((sunHoursPerDay * CONSTANTS.solarUsablePerHour - CONSTANTS.parasiticDrawDaily) >= 0 ? '+' : '')}
                      {(sunHoursPerDay * CONSTANTS.solarUsablePerHour - CONSTANTS.parasiticDrawDaily).toFixed(2)} Ah/day
                    </span>
                  </div>
                </div>
              </div>
            </div>
          );

          // Analytics Tab
          const AnalyticsTab = () => (
            <div className="space-y-6">
              {/* Scenario Comparison */}
              <div className="metric-card p-4">
                <h3 className="font-semibold mb-3 text-white">Maintenance Scenario Comparison</h3>
                {chartsLoaded ? (
                  <Recharts.ResponsiveContainer width="100%" height={300}>
                    <Recharts.BarChart data={scenarioData} layout="vertical">
                      <Recharts.CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                      <Recharts.XAxis 
                        type="number" 
                        label={{ value: 'Days', position: 'insideBottom', offset: -5, fill: '#9ca3af' }}
                        stroke="#9ca3af"
                      />
                      <Recharts.YAxis 
                        type="category" 
                        dataKey="scenario" 
                        width={120} 
                        style={{ fontSize: '12px', fill: '#d1d5db' }}
                        stroke="#9ca3af"
                      />
                      <Recharts.Tooltip 
                        contentStyle={{
                          backgroundColor: '#1f2937',
                          border: '1px solid #374151',
                          color: '#f3f4f6'
                        }}
                      />
                      <Recharts.Bar dataKey="daysDisplay" name="Days Until Charge Needed">
                        {scenarioData.map((entry, index) => (
                          <rect key={`cell-${index}`} fill={entry.color} />
                        ))}
                      </Recharts.Bar>
                    </Recharts.BarChart>
                  </Recharts.ResponsiveContainer>
                ) : (
                  createFallbackChart("Maintenance Scenario Comparison", scenarioData)
                )}
                <div className="mt-3 text-xs text-gray-400">
                  RS = Remote Start. Values capped at 365 days for display.
                </div>
              </div>

              {/* Solar Hours Impact */}
              <div className="metric-card p-4">
                <h3 className="font-semibold mb-3 text-white">Solar Hours Impact on Battery</h3>
                {chartsLoaded ? (
                  <Recharts.ResponsiveContainer width="100%" height={250}>
                    <Recharts.LineChart data={solarComparisonData}>
                      <Recharts.CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                      <Recharts.XAxis 
                        dataKey="hours" 
                        label={{ value: 'Sun Hours/Day', position: 'insideBottom', offset: -5, fill: '#9ca3af' }}
                        stroke="#9ca3af"
                      />
                      <Recharts.YAxis 
                        label={{ value: 'Ah/Day', angle: -90, position: 'insideLeft', fill: '#9ca3af' }}
                        stroke="#9ca3af"
                      />
                      <Recharts.Tooltip 
                        contentStyle={{
                          backgroundColor: '#1f2937',
                          border: '1px solid #374151',
                          color: '#f3f4f6'
                        }}
                      />
                      <Recharts.Legend wrapperStyle={{ color: '#d1d5db' }} />
                      <Recharts.Line type="monotone" dataKey="solarGain" stroke="#22c55e" strokeWidth={2} name="Solar Gain" />
                      <Recharts.Line type="monotone" dataKey="parasiticLoss" stroke="#ef4444" strokeWidth={2} name="Parasitic Loss" />
                      <Recharts.Line type="monotone" dataKey="netDaily" stroke="#3b82f6" strokeWidth={2} strokeDasharray="5 5" name="Net Daily" />
                    </Recharts.LineChart>
                  </Recharts.ResponsiveContainer>
                ) : (
                  createFallbackChart("Solar Hours Impact on Battery", solarComparisonData)
                )}
              </div>

              {/* Fuel Consumption Analysis */}
              <div className="metric-card p-4">
                <h3 className="font-semibold mb-3 text-white">Fuel Life Estimates</h3>
                <div className="grid grid-cols-2 gap-4">
                  {[
                    { rate: '1/month', months: 210, years: 17.5 },
                    { rate: '2/month', months: 105, years: 8.75 },
                    { rate: '3/month', months: 70, years: 5.8 },
                    { rate: '8/month', months: 26, years: 2.2 }
                  ].map((item, idx) => (
                    <div key={idx} className="border border-gray-700 rounded-lg p-3">
                      <div className="text-lg font-bold text-blue-600">{item.rate}</div>
                      <div className="text-sm text-gray-400">Remote Starts</div>
                      <div className="mt-2 text-sm text-gray-300">
                        <div><strong>{item.years}</strong> years</div>
                        <div className="text-xs text-gray-500">({item.months} months)</div>
                      </div>
                    </div>
                  ))}
                </div>
                <div className="mt-4 text-sm p-3 rounded text-gray-300 bg-blue-900/30">
                  <strong>Current fuel:</strong> {fuelLevel.toFixed(2)} gallons<br />
                  <strong>Starts remaining:</strong> {Math.floor(fuelLevel / CONSTANTS.fuelBurnRate)} starts
                </div>
              </div>
            </div>
          );

          // Settings Tab
          const SettingsTab = () => (
            <div className="space-y-6">
              <div className="metric-card p-4">
                <h3 className="font-semibold mb-4 text-white">Battery Configuration</h3>
                
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium mb-2 text-gray-300">Current Battery Level (%)</label>
                    <input 
                      type="range" 
                      min="0" 
                      max="100" 
                      value={batteryLevel}
                      onChange={(e) => setBatteryLevel(parseFloat(e.target.value))}
                      className="w-full"
                    />
                    <div className="text-right text-sm text-gray-400">{batteryLevel.toFixed(1)}%</div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-2 text-gray-300">Average Sun Hours per Day</label>
                    <input 
                      type="range" 
                      min="0" 
                      max="8" 
                      step="0.5"
                      value={sunHoursPerDay}
                      onChange={(e) => setSunHoursPerDay(parseFloat(e.target.value))}
                      className="w-full"
                    />
                    <div className="text-right text-sm text-gray-400">{sunHoursPerDay} hours</div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-2 text-gray-300">Fuel Level (gallons)</label>
                    <input 
                      type="number" 
                      min="0" 
                      max="13" 
                      step="0.1"
                      value={fuelLevel}
                      onChange={(e) => setFuelLevel(parseFloat(e.target.value))}
                      className="w-full border rounded px-3 py-2 bg-gray-700 border-gray-600 text-white"
                    />
                  </div>

                  <div className="flex items-center justify-between p-3 rounded bg-gray-700">
                    <span className="font-medium text-gray-200">5W Solar Panel Active</span>
                    <button 
                      onClick={() => setSolarPanelActive(!solarPanelActive)}
                      className={`${solarPanelActive ? 'bg-green-500' : 'bg-gray-500'} relative inline-flex h-6 w-11 items-center rounded-full transition`}
                    >
                      <span className={`${solarPanelActive ? 'translate-x-6' : 'translate-x-1'} inline-block h-4 w-4 transform rounded-full bg-white transition`} />
                    </button>
                  </div>

                  <div className="flex items-center justify-between p-3 rounded bg-gray-700">
                    <span className="font-medium text-gray-200">Dark Mode</span>
                    <button 
                      onClick={() => setDarkMode(!darkMode)}
                      className={`${darkMode ? 'bg-blue-500' : 'bg-gray-500'} relative inline-flex h-6 w-11 items-center rounded-full transition`}
                    >
                      <span className={`${darkMode ? 'translate-x-6' : 'translate-x-1'} inline-block h-4 w-4 transform rounded-full bg-white transition`} />
                    </button>
                  </div>
                </div>
              </div>

              {/* Technical Specifications */}
              <div className="metric-card p-4">
                <h3 className="font-semibold mb-3 text-white">Technical Specifications</h3>
                <div className="space-y-2 text-sm">
                  <div className="flex justify-between">
                    <span className="text-gray-400">Battery Capacity:</span>
                    <span className="font-medium text-gray-200">{CONSTANTS.batteryCapacity} Ah</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-400">Usable Capacity (50% DOD):</span>
                    <span className="font-medium text-gray-200">{CONSTANTS.usableCapacity} Ah</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-400">Parasitic Draw:</span>
                    <span className="font-medium text-gray-200">{CONSTANTS.parasiticDraw} A ({CONSTANTS.parasiticDrawDaily} Ah/day)</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-400">Remote Start Duration:</span>
                    <span className="font-medium text-gray-200">{CONSTANTS.remoteStartDuration} minutes</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-400">Remote Start Charge:</span>
                    <span className="font-medium text-gray-200">{CONSTANTS.remoteStartCharge} Ah per start</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-400">Remote Start Limit:</span>
                    <span className="font-medium text-gray-200">{CONSTANTS.remoteStartLimit} consecutive</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-400">Solar Panel Output:</span>
                    <span className="font-medium text-gray-200">{CONSTANTS.solarPanelWatts}W ({CONSTANTS.solarUsablePerHour} Ah/sun-hour)</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-400">Fuel Burn Rate:</span>
                    <span className="font-medium text-gray-200">{CONSTANTS.fuelBurnRate} gal/start</span>
                  </div>
                </div>
              </div>
            </div>
          );

          // History Tab
          const HistoryTab = () => (
            <div className="space-y-4">
              {/* Recent Remote Starts */}
              <div className="metric-card p-4">
                <h3 className="font-semibold mb-3 text-white">Recent Remote Starts</h3>
                {remoteStarts.length === 0 ? (
                  <p className="text-sm text-gray-400">No remote starts recorded yet.</p>
                ) : (
                  <div className="space-y-2">
                    {remoteStarts.slice(0, 10).map(start => (
                      <div key={start.id} className="flex justify-between items-center p-2 rounded bg-gray-700">
                        <div>
                          <div className="text-sm font-medium text-gray-200">{new Date(start.date).toLocaleString()}</div>
                          <div className="text-xs text-gray-400">+{start.ahGained} Ah, -{start.fuelUsed.toFixed(3)} gal</div>
                        </div>
                        <button 
                          onClick={() => setRemoteStarts(remoteStarts.filter(s => s.id !== start.id))}
                          className="text-red-500 hover:text-red-700"
                        >
                          <Icon name="trash2" className="w-4 h-4" />
                        </button>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              {/* Activity Log */}
              <div className="metric-card p-4">
                <h3 className="font-semibold mb-3 text-white">Activity Log</h3>
                {logs.length === 0 ? (
                  <p className="text-sm text-gray-400">No activity logged yet.</p>
                ) : (
                  <div className="space-y-2 max-h-96 overflow-y-auto">
                    {logs.map(log => (
                      <div key={log.id} className="p-2 rounded bg-gray-700">
                        <div className="text-xs text-gray-400">{new Date(log.date).toLocaleString()}</div>
                        <div className="text-sm text-gray-200">{log.message}</div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </div>
          );

          return (
            <div className="max-w-4xl mx-auto min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
              {/* Header */}
              <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 shadow-lg">
                <h1 className="text-xl font-bold flex items-center">
                  <Icon name="car" className="w-6 h-6 mr-2" />
                  Cruze Battery Tracker - Enhanced
                </h1>
                <p className="text-xs opacity-90 mt-1">Comprehensive Battery Maintenance System</p>
              </div>

              {/* Navigation */}
              <div className="bg-gray-800 border-gray-700 border-b flex overflow-x-auto">
                {[
                  { id: 'dashboard', label: 'Dashboard', icon: 'barChart3' },
                  { id: 'analytics', label: 'Analytics', icon: 'trendingDown' },
                  { id: 'history', label: 'History', icon: 'calendar' },
                  { id: 'settings', label: 'Settings', icon: 'settings' }
                ].map(tab => (
                  <button
                    key={tab.id}
                    onClick={() => setActiveTab(tab.id)}
                    className={`flex-1 py-3 px-4 font-medium text-sm flex items-center justify-center ${
                      activeTab === tab.id 
                        ? 'text-white bg-gradient-to-r from-blue-500 to-purple-500' 
                        : 'text-gray-400 hover:text-gray-200'
                    } tab-button ${activeTab === tab.id ? 'active' : ''}`}
                  >
                    <Icon name={tab.icon} className="w-4 h-4 mr-2" />
                    {tab.label}
                  </button>
                ))}
              </div>

              {/* Content */}
              <div className="p-4">
                {activeTab === 'dashboard' && <DashboardTab />}
                {activeTab === 'analytics' && <AnalyticsTab />}
                {activeTab === 'history' && <HistoryTab />}
                {activeTab === 'settings' && <SettingsTab />}
              </div>

              {/* Footer Info */}
              <div className="bg-gray-800 border-gray-700 text-gray-400 border-t p-4 text-center text-xs">
                <div className="flex items-center justify-center mb-2">
                  <Icon name="info" className="w-4 h-4 mr-1" />
                  <span>All calculations based on validated Chevy Cruze specifications</span>
                </div>
                <div>Parasitic Draw: 0.03A | Solar: 5W Panel | Remote Start: 10min cycles</div>
              </div>
            </div>
          );
        };

        // Render the app
        ReactDOM.createRoot(document.getElementById('root')).render(<BatteryTrackerApp />);
    </script>
</body>
</html>